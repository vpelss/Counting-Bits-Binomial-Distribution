
<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  
  
  

  <title>Counting Bits Binomial Distribution</title>

    <link rel="canonical" href="https://codepen.io/vpelss/pen/PwYbgKx">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  
  

  
  
  
</head>

<body>
  <p>
  1st Graph: Given a number of bits, count the frequency of set bits for all possible binary numbers. Pascal's triangle : Binomial distribution for p = 0.5
  <br>
  <a href="https://www.karlsims.com/marbles/" target="blank">https://www.karlsims.com/marbles/</a>
  <br>
  <a href="https://en.citizendium.org/wiki/Pascal%27s_triangle" target="blank">https://en.citizendium.org/wiki/Pascal%27s_triangle</a>
  <br>
  2nd Graph: Plot how many bits are in the binary representation of each number.
</p>

<form>
  <label for="bits">Number of bits (1000 max):</label>
  <input type="number" id="bits" name="bits" min="0" max="1000" value="4" required>
  &nbsp;
  <button type="button" id="runforest" value="1">Plot</button>
</form>

<div id="plot2"></div>

<div id="plot1"></div>
  <script src='https://cdn.plot.ly/plotly-3.1.0.min.js'></script>
      <script id="rendered-js" >
// https://www.geeksforgeeks.org/count-set-bits-in-an-integer/
// https://www.mathsisfun.com/combinatorics/combinations-permutations.html
//https://blog.demofox.org/2017/07/25/counting-bits-the-normal-distribution/

//plotly has array limit? can this be overcome?

//set html events
let run_forest = document.getElementById("runforest");
run_forest.onclick = RunForestRun;

// JS limits:

// 16 bit width will not work for NumberOfSetBitsInX array as array limit is 2 ^ 16. So we turn off top graph

// 171 bits INT will not work in factorial(), so need to use BigInt
//we could optimize/simplify the factoaial over factorial by cancelling out similar values, but it is not worth it. bigint does a pretty good job

//plotly can only plot y values up to... so maybe divide bigint values to normalize?

function RunForestRun() {
  let xNnumber = [];
  let NumberOfSetBitsInX = [];
  let HowManyNumbersWithXBitsSet = {};

  document.getElementById("plot1").innerHTML = ""; //clear plots if any
  document.getElementById("plot2").innerHTML = ""; //clear plots if any
  let bits = BigInt(document.getElementById("bits").value); //limit to 170 or factorial hits JS infinity

  let pow = Math.pow(2, Number(bits));
  let possible1Bits = [];
  let possible1BitsCount = [];
  let limit = 16; //for large numbers turn off manual count and plot of number of
  let under16;

  if (bits <= limit) {
    under16 = true;
  }

  //bits per number because of js array limit : 2^16 is too big
  //if (bits < limit) { //less than 171
  if (under16) {
    for (a = 0; a < pow; a++) {
      //how many bits in this number
      let numberOfBits = a
        .toString(2)
        .split("")
        .filter((x) => x == "1").length;
      xNnumber.push(a);
      NumberOfSetBitsInX.push(numberOfBits);
    }
  }

  //calculate a row in pascal's triange. same as Binomial distribution for p = 0.5
  //https://www.calculatorsoup.com/calculators/discretemathematics/pascals-triangle.php
  for (bit = 0n; bit <= bits; bit++) {
    if (bit == 0 || bit == bits) {
      HowManyNumbersWithXBitsSet[bit] = 1;
      continue;
    }
    let count = factorial(bits) / (factorial(bit) * factorial(bits - bit));
    HowManyNumbersWithXBitsSet[bit] = count;
  }

  //convert obj HowManyNumbersWithXBitsSet[numberOfBits] = howMany
  //into to 2 arrays for plotting
  let keys = Object.keys(HowManyNumbersWithXBitsSet);
  keys = keys.sort();
  keys.forEach(function (x) {
    possible1Bits.push(x);
    possible1BitsCount.push(Number(HowManyNumbersWithXBitsSet[x]));
  });

  if (under16) {
    //only plot for less than 16 bits
    let data = [
      {
        x: xNnumber,
        y: NumberOfSetBitsInX,
        type: "bar",
        _orientation: "v",
        _marker: { color: "rgba(0,0,255)" }
      }
    ];
    let layout = {
      title: {
        text: "Number of set bits for each binary number"
      },
      xaxis: {
        title: {
          text: "Binary Number"
        }
      },
      yaxis: {
        title: {
          text: "Number of set bits"
        }
      }
    };
    Plotly.newPlot("plot1", data, layout);
  } else {
    document.getElementById("plot1").innerHTML = "Off due to JS array limit";
  }

  data2 = [
    {
      type: "bar",
      _orientation: "v",
      _marker: { color: "rgba(0,0,255)" },
      x: possible1Bits,
      y: possible1BitsCount
    }
  ];

  layout2 = {
    title: {
      text: "How many binary numbers with x set bit"
    },
    xaxis: {
      title: {
        text: "Number of set bits"
      }
    },
    yaxis: {
      title: {
        text: "How many numbers"
      }
    }
  };
  Plotly.newPlot("plot2", data2, layout2);
}

function factorial(num) {
  var result = num;
  if (num === 0 || num === 1) return 1;
  while (num > 1) {
    num--;
    result *= num;
  }
  return result;
}

RunForestRun();
    </script>

  
</body>

</html>
